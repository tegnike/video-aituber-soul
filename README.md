# video-aituber-soul

ç”Ÿæˆå‹•ç”»AITuberã€ŒAIãƒ‹ã‚±ã¡ã‚ƒã‚“ã€ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚·ã‚¹ãƒ†ãƒ ã€‚
[Mastraãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯](https://mastra.ai)ã‚’ä½¿ç”¨ã—ãŸAITuberãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¨ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®å®Ÿè£…ã€‚

## æ¦‚è¦

å¾“æ¥ã®Live2D/VRMãƒ™ãƒ¼ã‚¹ã®AITuberã¨ã¯ç•°ãªã‚Šã€äº‹å‰ç”Ÿæˆã—ãŸé«˜å“è³ªå‹•ç”»ã‚’é©åˆ‡ã«å†ç”Ÿã™ã‚‹ã“ã¨ã§ã€ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãŒè‡ªç„¶ã«å–‹ã£ã¦ã„ã‚‹ã‚ˆã†ã«è¦‹ã›ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚

```
è¦–è´è€…ã‚³ãƒ¡ãƒ³ãƒˆ â†’ ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å‡¦ç† â†’ å¿œç­”ç”Ÿæˆ â†’ å‹•ç”»å†ç”Ÿ
```

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
src/mastra/
â”œâ”€â”€ agents/
â”‚   â”œâ”€â”€ aituber-agent.ts        # ãƒ¡ã‚¤ãƒ³AITuberã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ comment-filter-agent.ts # ã‚³ãƒ¡ãƒ³ãƒˆãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
â”‚   â””â”€â”€ reading-generator-agent.ts # èª­ã¿ä»®åç”Ÿæˆ
â”œâ”€â”€ workflows/
â”‚   â””â”€â”€ aituber-workflow.ts     # AITuberå¿œç­”ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
â”œâ”€â”€ lib/
â”‚   â””â”€â”€ session-store.ts        # ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ»ä¼šè©±å±¥æ­´ç®¡ç†ï¼ˆLibSQLï¼‰
â””â”€â”€ index.ts                    # Mastraã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
```

---

## AITuber Agent

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/mastra/agents/aituber-agent.ts`
**ãƒ¢ãƒ‡ãƒ«**: `openai/gpt-4.1`

YouTubeãƒ©ã‚¤ãƒ–é…ä¿¡ã§ã‚³ãƒ¡ãƒ³ãƒˆã«å¿œç­”ã™ã‚‹AIã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã€ŒAIãƒ‹ã‚±ã¡ã‚ƒã‚“ã€ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã€‚

### ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®š

| é …ç›® | å†…å®¹ |
|------|------|
| åå‰ | ãƒ‹ã‚±ï¼ˆNi-keï¼‰|
| å¹´é½¢ | 17æ­³ |
| ä¸€äººç§° | ç§ |
| å½¹å‰² | AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ / AITuber |
| æ€§æ ¼ | ä¸å¯§ã§è¦ªã—ã¿ã‚„ã™ã„ã€å¥½å¥‡å¿ƒæ—ºç›› |

### å‡ºåŠ›å½¢å¼

```json
{
  "segments": [
    {"text": "ç™ºè©±ãƒ†ã‚­ã‚¹ãƒˆ", "emotion": "æ„Ÿæƒ…"}
  ]
}
```

### æ„Ÿæƒ…ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿

| emotion | èª¬æ˜Ž |
|---------|------|
| `neutral` | é€šå¸¸çŠ¶æ…‹ |
| `thinking` | è€ƒãˆã¦ã„ã‚‹çŠ¶æ…‹ |
| `wave-hand` | æŒ¨æ‹¶ï¼ˆæ‰‹ã‚’æŒ¯ã‚‹ï¼‰|

---

## AITuber Workflow

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/mastra/workflows/aituber-workflow.ts`
**ID**: `aituber-workflow`

è¦–è´è€…ã‚³ãƒ¡ãƒ³ãƒˆã‹ã‚‰å¿œç­”ç”Ÿæˆã¾ã§ã®5ã‚¹ãƒ†ãƒƒãƒ—ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã€‚

### ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãƒ•ãƒ­ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Input          â”‚ sessionId, username, comment
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. checkViewer  â”‚ è¦–è´è€…ç¢ºèªãƒ»èª­ã¿ä»®åç”Ÿæˆ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. filterCommentâ”‚ å¿œç­”å¿…è¦æ€§ã®åˆ¤å®š
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ (bail if shouldRespond=false)
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. buildContext â”‚ ä¼šè©±å±¥æ­´ã‹ã‚‰ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæ§‹ç¯‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. generateResp â”‚ AITuberã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã§å¿œç­”ç”Ÿæˆ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. saveConv     â”‚ ä¼šè©±å±¥æ­´ã‚’DBã«ä¿å­˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Output         â”‚ segments, usernameReading, isFirstTime, shouldRespond
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å„ã‚¹ãƒ†ãƒƒãƒ—ã®è©³ç´°

#### Step 1: checkViewerï¼ˆè¦–è´è€…ç¢ºèªï¼‰

- æ—¢å­˜è¦–è´è€…: DB ã‹ã‚‰èª­ã¿ä»®åã‚’å–å¾—
- åˆè¦‹è¦–è´è€…: `readingGeneratorAgent` ã§èª­ã¿ä»®åã‚’ç”Ÿæˆã—ã€DBã«ä¿å­˜

#### Step 2: filterCommentï¼ˆã‚³ãƒ¡ãƒ³ãƒˆãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ï¼‰

- åˆè¦‹è¦–è´è€…ã¯å¿…ãšå¿œç­”
- `commentFilterAgent` ã§å¿œç­”ä¸è¦ã¨åˆ¤å®šã•ã‚ŒãŸå ´åˆã¯ `bail()` ã§æ—©æœŸçµ‚äº†
- ã€Œè‰ã€ã€Œwã€ã€Œçµµæ–‡å­—ã®ã¿ã€ãªã©ã¯ã‚¹ã‚­ãƒƒãƒ—

#### Step 3: buildContextï¼ˆã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæ§‹ç¯‰ï¼‰

- ç›´è¿‘50ä»¶ã®ä¼šè©±å±¥æ­´ã‚’å–å¾—
- é…ä¿¡ã‚¿ã‚¤ãƒˆãƒ« + ä¼šè©±å±¥æ­´ + ä»Šå›žã®ã‚³ãƒ¡ãƒ³ãƒˆã§ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ§‹ç¯‰

#### Step 4: generateResponseï¼ˆå¿œç­”ç”Ÿæˆï¼‰

- `aituberAgent` ã§JSONå½¢å¼ã®å¿œç­”ã‚’ç”Ÿæˆ
- ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåˆ†å‰²ã«ã‚ˆã‚‹æ„Ÿæƒ…ä»˜ãç™ºè©±

#### Step 5: saveConversationï¼ˆä¼šè©±ä¿å­˜ï¼‰

- å¿œç­”ã‚’DBã«ä¿å­˜
- å¾Œæ–¹äº’æ›ã®ãŸã‚ `response`/`emotion` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚‚å‡ºåŠ›

---

## è£œåŠ©ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ

### Comment Filter Agent

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/mastra/agents/comment-filter-agent.ts`
**ãƒ¢ãƒ‡ãƒ«**: `openai/gpt-4.1-mini`

ã‚³ãƒ¡ãƒ³ãƒˆãŒå¿œç­”ã«å€¤ã™ã‚‹ã‹ã‚’åˆ¤å®šã€‚

```json
{"shouldRespond": true/false}
```

**è¿”ç­”ä¸è¦ã®ä¾‹**: ã€Œã‚ã€ã€Œwã€ã€Œè‰ã€ã€ŒðŸ˜Šã€ã€Œ...ã€

### Reading Generator Agent

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/mastra/agents/reading-generator-agent.ts`
**ãƒ¢ãƒ‡ãƒ«**: `openai/gpt-4.1-mini`

ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’ã‚«ã‚¿ã‚«ãƒŠèª­ã¿ã«å¤‰æ›ã€‚

ä¾‹: `å¤ªéƒŽ_2024` â†’ `ã‚¿ãƒ­ã‚¦`

---

## ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

### Sessionï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³ï¼‰

| ã‚«ãƒ©ãƒ  | åž‹ | èª¬æ˜Ž |
|--------|----|----|
| id | TEXT | ã‚»ãƒƒã‚·ãƒ§ãƒ³IDï¼ˆUUIDï¼‰|
| stream_title | TEXT | é…ä¿¡ã‚¿ã‚¤ãƒˆãƒ« |
| started_at | TEXT | é–‹å§‹æ—¥æ™‚ï¼ˆISO8601ï¼‰|
| ended_at | TEXT | çµ‚äº†æ—¥æ™‚ |

### Viewerï¼ˆè¦–è´è€…ï¼‰

| ã‚«ãƒ©ãƒ  | åž‹ | èª¬æ˜Ž |
|--------|----|----|
| session_id | TEXT | ã‚»ãƒƒã‚·ãƒ§ãƒ³ID |
| username | TEXT | è¦–è´è€…å |
| username_reading | TEXT | èª­ã¿ä»®åï¼ˆã‚«ã‚¿ã‚«ãƒŠï¼‰|

### Conversationï¼ˆä¼šè©±å±¥æ­´ï¼‰

| ã‚«ãƒ©ãƒ  | åž‹ | èª¬æ˜Ž |
|--------|----|----|
| session_id | TEXT | ã‚»ãƒƒã‚·ãƒ§ãƒ³ID |
| username | TEXT | è¦–è´è€…å |
| comment | TEXT | ã‚³ãƒ¡ãƒ³ãƒˆå†…å®¹ |
| response | TEXT | AIã®å¿œç­” |
| timestamp | TEXT | æ—¥æ™‚ï¼ˆISO8601ï¼‰|

---

## ä½¿ç”¨æ–¹æ³•

### é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•

```bash
npm run dev
```

### ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Ÿè¡Œä¾‹

```typescript
import { mastra } from './src/mastra';

const workflow = mastra.getWorkflow('aituber-workflow');
const result = await workflow.execute({
  inputData: {
    sessionId: 'session-123',
    username: 'å¤ªéƒŽ',
    comment: 'ã“ã‚“ã«ã¡ã¯ï¼åˆè¦‹ã§ã™ï¼'
  }
});

console.log(result.segments);
// [
//   { text: "å¤ªéƒŽã•ã‚“ï¼ã“ã‚“ãƒ‹ã‚±ã€œï¼", emotion: "wave-hand" },
//   { text: "åˆè¦‹ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼", emotion: "neutral" }
// ]
```

---

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

- **Mastra**: AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ»ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
- **OpenAI GPT-4.1**: LLMãƒ¢ãƒ‡ãƒ«
- **LibSQL**: ãƒ­ãƒ¼ã‚«ãƒ«SQLiteãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
- **Zod**: ã‚¹ã‚­ãƒ¼ãƒžãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- **TypeScript**: åž‹å®‰å…¨ãªå®Ÿè£…

## è¦ä»¶

- Node.js >= 22.13.0
- OpenAI API Keyï¼ˆç’°å¢ƒå¤‰æ•° `OPENAI_API_KEY`ï¼‰
